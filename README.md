# HTTPServerAndLogFileParsing
This is a repository to implement a basic HTTP server in PHP using sockets to handle HTTP requests and to write a small script that parses the log file generated by the server and take care of some statistics.
The task description will be attached at the end of ReadMe.

## Getting started:
### Prerequisites
PHP installed on your system (version 7.x recommended). 

PHPUnit installed for running tests (optional for development).

## Dependency Management with Poetry for Python scripts
This project uses Poetry for managing Python dependencies.
Poetry is a tool that simplifies dependency management by providing consistent and reliable package installations.

### Install Poetry
Install pipx if you haven't already. Other methods see [here](https://python-poetry.org/docs/#installation).
```BASH
pipx install poetry
```
Once Poetry is installed, navigate to the project directory and run the following command to ‘initialise’ a pre-populated directory:
```BASH
poetry init 
```
This command reads the pyproject.toml file and installs all necessary dependencies for the project.

### Usage
To run a Python script using Poetry, use the following command:

```bash
poetry run python python/src/traffic_analyser.py
```
This command ensures that the script runs within the Poetry environment, using the correct dependencies.

### Updating Dependencies
To update all dependencies to their latest compatible versions, run:
```bash
poetry update
```

### Generate a requirements.txt file
To generate a requirements.txt file from the pyproject.toml file, run:
```bash
poetry export --without-hashes --format=requirements.txt > requirements.txt
```

## Usage
### Start the Server
```PHP
php php/src/my-web-server.php  127.0.0.1 8080
```
or
```PHP
php php/src/my-web-server.php  127.0.0.1 8080 logs/server.log
```

### Send sample requests to the server using curl for generating log records:
```BASH
curl -X GET http://127.0.0.1:8080/path2
curl -X GET http://127.0.0.1:8080/
curl -X GET http://127.0.0.1:8080/path1
curl -X POST http://127.0.0.1:8080/
```

### Send sample requests to the server using python script for generating log records:
```BASH
poetry run python src/request.py
```

### Run the traffic analyser:
```BASH
poetry run  python python/src/traffic_analyser.py --from "2024-07-03 19:00:00" --to "2024-07-04 01:00:00"
```

## Tests
To run the tests, you need to have PHPUnit installed on your system. You can install PHPUnit using Composer or download the PHAR file from the official website.
```BASH
phpunit php/tests/MyWebServerTest.php
```
(The tests for the traffic analyser are not finished yet.)

## Others

### Python file formatting:
To format the python files, use the following command:
```bash
poetry run black .
```

### Example output of the traffic analyser:
```bash
Analyzing traffic from 2024-07-03 18:05:43.967541 to 2024-07-04 04:05:43.967559
Statistics from 2024-07-03 18:05:43.967541 to 2024-07-04 04:05:43.967559
Maximum RPM: 3600.00
Average RPM: 0.21
95 percentile: 22.64
HTTP Status Code Rate per minute: 0.2066205441628145
Anomalies detected at the following timestamps:
2024-07-03 19:19:33
2024-07-03 21:13:53
2024-07-03 21:36:32
2024-07-03 21:50:52
2024-07-03 22:42:25
2024-07-03 23:11:03
2024-07-03 23:35:45
2024-07-04 00:13:06
2024-07-04 00:23:42
2024-07-04 02:56:34
2024-07-04 03:59:26
```


### To be developed in the future:
1. More robust way to handle the request and response.
2. More tests for the server.
3. Use postgresSQL to store the logs with UUIDs.
4. Draw graphs for the statistics.
5. Use pipeline to run the tests automatically.
6. Think about if necessary to use virtual environment for python scripts.
7. Create docker image for the server and the analyser (to do soon).


## Task Description:
### Task 1: HTTP Server
In this exercise you will write a basic HTTP server in PHP using sockets to handle HTTP
requests.
1. You cannot use the inbuilt webserver that comes with PHP.
2. Your script should run via command line.
   e.g. If your server script is named “my-web-server.php”, you should be able to
   run it using the PHP CLI:
   php my-web-server.php
3. When starting the webserver, you should be able to pass a host and a port as
   arguments to bind to
4. All requests handled by this webserver should be logged to a file (you are free to
   choose the format, depending on the next exercise)

### Task 2: Log file parsing
From the web server access log file generated in 1. and using either PHP or Python, write
a small script that parses the log file and
1. prints
   a. max, average and 95th percentile (request/min)
   b. http status code rate per minute
2. Your script should run via command line.
   e.g. If your server script is named “my-web-server-traTic-analyser.php”, you
   should be able to run it using the PHP CLI:
   php my-web-server-traffic-analyser.php
3. Your script should accept 2 parameters “from” and “to” that filters for log entries
   only during this period, if not set then the default time range to consider should
   be the last 1 hour.
4. Bonus (not required): parse the access log file and print any anomalies using
   Isolation Forest

Example partial output of the program:
- Statistics from 2023-06-14 08:00:00 to 2023-06-14 09:00:00
- Maximum RPM: 120
- Average RPM: 75.67
- 95 percentile: 110
